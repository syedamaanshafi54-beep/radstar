{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the e-commerce store, specifically an Asli Talbina variant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product variant (e.g., Talbina Regular, Talbina Chocolate Almond)."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product, including ingredients and benefits."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "nutrientInformation": {
          "type": "string",
          "description": "Nutritional information about the product."
        },
        "variantType": {
          "type": "string",
          "description": "Describes if the product is a variant of Asli Talbina or another product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "variantType"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of the e-commerce store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "addressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: Customer 1:1 Address)"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "addressId"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "shippingAddressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: Order 1:1 Address)"
        },
        "billingAddressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: Order 1:1 Address)"
        },
        "orderStatus": {
          "type": "string",
          "description": "Status of the order (e.g., Pending, Processing, Shipped, Delivered)."
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "shippingAddressId",
        "billingAddressId",
        "orderStatus"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "itemPrice": {
          "type": "number",
          "description": "Price of the item at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "itemPrice"
      ]
    },
    "Address": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Address",
      "type": "object",
      "description": "Represents an address.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the address."
        },
        "streetAddress": {
          "type": "string",
          "description": "Street address."
        },
        "city": {
          "type": "string",
          "description": "City."
        },
        "state": {
          "type": "string",
          "description": "State."
        },
        "postalCode": {
          "type": "string",
          "description": "Postal code."
        },
        "country": {
          "type": "string",
          "description": "Country."
        }
      },
      "required": [
        "id",
        "streetAddress",
        "city",
        "state",
        "postalCode",
        "country"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible to all users for listing and display.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profile information. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. Must match the authenticated user's UID."
            },
            {
              "name": "customerId",
              "description": "The unique identifier of the customer. This is included to allow easier access to the customer document. The `userId` and `customerId` should be identical."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for each user. Accessible only to the authenticated user. Includes denormalized 'customerId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. Must match the authenticated user's UID."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order items for each order. Accessible only to the authenticated user who owns the order. Includes denormalized 'orderId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. Must match the authenticated user's UID."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/addresses/{addressId}",
        "definition": {
          "entityName": "Address",
          "schema": {
            "$ref": "#/backend/entities/Address"
          },
          "description": "Stores address information for each user. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. Must match the authenticated user's UID."
            },
            {
              "name": "addressId",
              "description": "Unique identifier for the address."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to follow best practices for security, scalability, and debuggability, prioritizing Authorization Independence and Structural Segregation.\n\nAuthorization Independence is achieved through denormalization. For example, access to orders is determined by the customer. Therefore, the customerId is embedded within the order document. This removes the need for `get()` calls in security rules, crucial for atomic operations.\n\nStructural Segregation is implemented to ensure that each collection has a homogeneous security posture. User-specific data (Customer, Orders, Addresses) are stored under the `/users/{userId}` path to ensure only the user can access their data.\n\nAccess Modeling is standardized with private user data following path-based ownership (`/users/{userId}/...`).\n\nThis structure supports the required QAPs by:\n\n*   Enabling secure `list` operations due to the segregation of data based on ownership and role.\n*   Eliminating the need for filtering in rules because each collection contains data with a consistent security posture.\n*   Supporting invariants such as ownership and timestamps with the structured collection paths."
  }
}